---
layout: post
title: 'Twelve Factor Apps: Spring Cloud Config'
date: '2017-04-22T11:16:00.000-04:00'
author: Alberto
tags:
- Spring-Cloud-Config
- Spring-Boot
- Spring-Cloud
- 12Factor
- Cloud
- Microservices
modified_time: '2017-04-22T11:17:16.904-04:00'
blogger_id: tag:blogger.com,1999:blog-4831432806087932521.post-4909880037781927593
blogger_orig_url: https://alberto-flores.blogspot.com/2017/04/twelve-factor-apps-spring-cloud-config.html
---

<br />I have been using Spring for many years now and I really like the simplicity and non-invasive model of its features. As I have been implementing <a href="https://12factor.net/" target="_blank">12 Factor</a> applications, I needed to start using a central way to configure the many microservices we are building. This is where <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Spring Cloud Config</span> comes to the rescue.<br /><br /><a name='more'></a><br /><h3>Spring Cloud Config Architecture</h3><br />The basic premise is that each application (microservice) can have it's own configuration, but in addition, can receive configuration from a central configuration system - a configuration server. This configuration server is incredibly easy to create with Spring Boot. The following snippets creates the configuration<br /><br /><script src="https://gist.github.com/albertoaflores/d6b8e1a55251299ab60e7bfc25b133bb.js"></script> The following is my example <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">application.yml</span> file that configures my instance of <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Config Server</span>:<br /><br /><script src="https://gist.github.com/albertoaflores/1807f326333d7fdb5db4740e170bf66d.js"></script>A few things to notice:<br /><ol><li>By default config server will handle encryption following a pre-determined heuristic. More on that later. Suffice to say that the above configuration is meant to make decryption to happen at the client side instead of the server holding the data.</li><li>The key (sample gist shown below) has to be provided for the purposes of ...</li><li>The location of the configuration is stored in a git repository. This so happen to be in my local file system, but can be anywhere. One cool aspect of this is that client applications can use a given version, branch or tag of the configuration within this git repo. Version management of configuration is an interesting topic as "<a href="http://tscm.io/blog-highlyconfigurablesoftware.php" target="_blank">highly configurable</a>" software is an interesting concept to implement while preserving the integrity of the application.</li><li>The documentation assumes that users of this JVM have installed the&nbsp;<a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" target="_blank">Unlimited Strength JCE</a>.</li></ol><h3>Encryption of Values</h3><br /><div>While there are many ways to protect your configuration server, a common requirement is about protecting the data (configuration) that is stored on file disk as well as to protect it while in transit. This is pretty common for passwords, hostnames, IPs, etc. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Spring Cloud Config</span> offers some options in this space. I recommend asymmetric key encryption for the purposes of protecting the data. The example applications I use on my github repo uses the following script to create the key:</div><br /><div><script src="https://gist.github.com/albertoaflores/9f569208152e745061b36130c44f2f57.js"></script></div><div><br /></div>Applications using the above <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Spring Config Server</span> can use it's properties using the following <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">bootstrap.yml</span> file:<br /><br /><script src="https://gist.github.com/albertoaflores/92f273699b458dffd266e736cd8db5a2.js"></script> <br /><div><h3>Lessons Learned:</h3><ul><li>I have seen some implementation of "config server" (non Spring solutions) that queries each property remotely. This is dangerous as you can DDOS our own config server on deployment. In <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Spring Cloud Config</span>, the entire properties file is sent over a single HTTP request.</li><li>I have been using Spring Cloud release Camden.SR6 (Important). While doing so, I found a bug described&nbsp;<a href="https://github.com/spring-cloud/spring-cloud-commons/issues/191" target="_blank">here</a>&nbsp;that was causing issues to the decrypting of properties server side.</li><li>Using defaults is an important strategy. Use it with care. &nbsp;</li><li>You can encrypt/decrypt properties using the endpoint (from the server) located at:</li><ul><li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;localhost:8888/encrypt -d "foo"</span></li></ul><li>Properties with the following entry will be decipher as needed:</li><ul><li>message='{cipher}xxx'</li></ul><li>Careful between YML and properties files and the {cipher} prefix. As you know, Spring supports property values from "properties" and YML files. Each are supported a bit differently due to the nature of the file (parsers will interpret them differently). This is important to note as the "single" quote may not be needed in one vs the other.</li></ul></div><br /><br /><br />