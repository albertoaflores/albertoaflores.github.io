---
layout: post
title: Surefire/Failsafe maven plugin and SSL
date: '2012-07-03T09:17:00.000-04:00'
author: Alberto
tags:
- JUnit
- SSL
- Maven
modified_time: '2012-07-03T09:17:00.274-04:00'
blogger_id: tag:blogger.com,1999:blog-4831432806087932521.post-6129780403647568288
blogger_orig_url: https://alberto-flores.blogspot.com/2012/07/surefirefailsafe-maven-plugin-and-ssl.html
---

I was puzzled today by an interesting feature introduced by the "<span style="font-family: 'Courier New', Courier, monospace;">surefire</span>" and "f<span style="font-family: 'Courier New', Courier, monospace;">ailsafe</span>" maven plugins (used for unit/integration test my components). These were introduced with their 2.1 release. &nbsp;As I had components calling web services using 2-way SSL for authentication, I noticed that my test cases where failing when using maven via command line (<span style="font-family: 'Courier New', Courier, monospace;">mvn clean install</span>). They worked on the IDE (Eclipse/STS) fine, but were not working on the command line. I saw the following error:<blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace;">PKIX path building failed: ... unable to find valid certification path to requested target</span></blockquote>&nbsp;So it was clear that maven was not passing the SSL system properties from my .mavenrc file:<br /><br /><script src="https://gist.github.com/3039442.js?file=.mavenrc"></script><br />This is what I discovered as I read more the documentation.<br /><a name='more'></a><br /><br />As it turns out, since the 2.1 release both "<span style="font-family: 'Courier New', Courier, monospace;">surefire</span>" and "<span style="font-family: 'Courier New', Courier, monospace;">failsafe</span>" maven plugins introduced the "optional" parameter to specify the "<span style="font-family: 'Courier New', Courier, monospace;">jvm</span>" for a given test. I can see why it's a useful idea, but I missed to read the "small" foot print:<br /><blockquote class="tr_bq"><span style="background-color: #f9f9f9; color: #404040; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 18px; text-align: left;"><i>Option to specify the jvm (or path to the java executable) to use with the forking options. For the default, the jvm will be a new instance of the same VM as the one used to run Maven. JVM settings are <u>not inherited</u> from MAVEN_OPTS.</i></span></blockquote>This means that based on the "<span style="font-family: 'Courier New', Courier, monospace;">forkMode</span>" option, a new VM will (potentially) be started. I tested this by trying the "<span style="font-family: 'Courier New', Courier, monospace;">forkMode=never</span>" configuration. This made my test successfully call the secured web service. As I didn't like that approach, I opted for the plugin configuration approach using the "<span style="font-family: 'Courier New', Courier, monospace;">systemPropertiesVariables</span>" configuration:<br /><br /><script src="https://gist.github.com/3039515.js?file=sample-surefire-pom.xml"></script><br />Notice that I also added SSL debug flags to see more verbose logging. This configuration ensured that my test was getting the SSL flags needed to enable 2-way SSL and continue operations. This was a small "gotcha" of the "<span style="font-family: 'Courier New', Courier, monospace;">surefire</span>" and "<span style="font-family: 'Courier New', Courier, monospace;">failsafe</span>" plugins. I'm glad they actually documented this feature.